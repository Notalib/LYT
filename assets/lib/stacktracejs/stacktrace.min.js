!function(n,e){"object"==typeof exports?module.exports=e():"function"==typeof define&&define.amd?define(e):n.printStackTrace=e()}(this,function(){function n(e){e=e||{guess:!0};var t=e.e||null,r=!!e.guess,c=new n.implementation,o=c.run(t);return r?c.guessAnonymousFunctions(o):o}return n.implementation=function(){},n.implementation.prototype={run:function(n,e){return n=n||this.createException(),e=e||this.mode(n),"other"===e?this.other(arguments.callee):this[e](n)},createException:function(){try{this.undef()}catch(n){return n}},mode:function(n){return n.arguments&&n.stack?"chrome":n.stack&&n.sourceURL?"safari":n.stack&&n.number?"ie":n.stack&&n.fileName?"firefox":n.message&&n["opera#sourceloc"]?n.stacktrace?n.message.indexOf("\n")>-1&&n.message.split("\n").length>n.stacktrace.split("\n").length?"opera9":"opera10a":"opera9":n.message&&n.stack&&n.stacktrace?n.stacktrace.indexOf("called from line")<0?"opera10b":"opera11":n.stack&&!n.fileName?"chrome":"other"},instrumentFunction:function(e,t,r){e=e||window;var c=e[t];e[t]=function(){return r.call(this,n().slice(4)),e[t]._instrumented.apply(this,arguments)},e[t]._instrumented=c},deinstrumentFunction:function(n,e){n[e].constructor===Function&&n[e]._instrumented&&n[e]._instrumented.constructor===Function&&(n[e]=n[e]._instrumented)},chrome:function(n){return(n.stack+"\n").replace(/^[\s\S]+?\s+at\s+/," at ").replace(/^\s+(at eval )?at\s+/gm,"").replace(/^([^\(]+?)([\n$])/gm,"{anonymous}() ($1)$2").replace(/^Object.<anonymous>\s*\(([^\)]+)\)/gm,"{anonymous}() ($1)").replace(/^(.+) \((.+)\)$/gm,"$1@$2").split("\n").slice(0,-1)},safari:function(n){return n.stack.replace(/\[native code\]\n/m,"").replace(/^(?=\w+Error\:).*$\n/m,"").replace(/^@/gm,"{anonymous}()@").split("\n")},ie:function(n){return n.stack.replace(/^\s*at\s+(.*)$/gm,"$1").replace(/^Anonymous function\s+/gm,"{anonymous}() ").replace(/^(.+)\s+\((.+)\)$/gm,"$1@$2").split("\n").slice(1)},firefox:function(n){return n.stack.replace(/(?:\n@:0)?\s+$/m,"").replace(/^(?:\((\S*)\))?@/gm,"{anonymous}($1)@").split("\n")},opera11:function(n){for(var e="{anonymous}",t=/^.*line (\d+), column (\d+)(?: in (.+))? in (\S+):$/,r=n.stacktrace.split("\n"),c=[],o=0,s=r.length;s>o;o+=2){var i=t.exec(r[o]);if(i){var a=i[4]+":"+i[1]+":"+i[2],u=i[3]||"global code";u=u.replace(/<anonymous function: (\S+)>/,"$1").replace(/<anonymous function>/,e),c.push(u+"@"+a+" -- "+r[o+1].replace(/^\s+/,""))}}return c},opera10b:function(n){for(var e=/^(.*)@(.+):(\d+)$/,t=n.stacktrace.split("\n"),r=[],c=0,o=t.length;o>c;c++){var s=e.exec(t[c]);if(s){var i=s[1]?s[1]+"()":"global code";r.push(i+"@"+s[2]+":"+s[3])}}return r},opera10a:function(n){for(var e="{anonymous}",t=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,r=n.stacktrace.split("\n"),c=[],o=0,s=r.length;s>o;o+=2){var i=t.exec(r[o]);if(i){var a=i[3]||e;c.push(a+"()@"+i[2]+":"+i[1]+" -- "+r[o+1].replace(/^\s+/,""))}}return c},opera9:function(n){for(var e="{anonymous}",t=/Line (\d+).*script (?:in )?(\S+)/i,r=n.message.split("\n"),c=[],o=2,s=r.length;s>o;o+=2){var i=t.exec(r[o]);i&&c.push(e+"()@"+i[2]+":"+i[1]+" -- "+r[o+1].replace(/^\s+/,""))}return c},other:function(n){for(var e,t,r="{anonymous}",c=/function(?:\s+([\w$]+))?\s*\(/,o=[],s=10,i=Array.prototype.slice;n&&o.length<s;){e=c.test(n.toString())?RegExp.$1||r:r;try{t=i.call(n.arguments||[])}catch(a){t=["Cannot access arguments: "+a]}o[o.length]=e+"("+this.stringifyArguments(t)+")";try{n=n.caller}catch(a){o[o.length]="Cannot access caller: "+a;break}}return o},stringifyArguments:function(n){for(var e=[],t=Array.prototype.slice,r=0;r<n.length;++r){var c=n[r];void 0===c?e[r]="undefined":null===c?e[r]="null":c.constructor&&(e[r]=c.constructor===Array?c.length<3?"["+this.stringifyArguments(c)+"]":"["+this.stringifyArguments(t.call(c,0,1))+"..."+this.stringifyArguments(t.call(c,-1))+"]":c.constructor===Object?"#object":c.constructor===Function?"#function":c.constructor===String?'"'+c+'"':c.constructor===Number?c:"?")}return e.join(",")},sourceCache:{},ajax:function(n){var e=this.createXMLHTTPObject();if(e)try{return e.open("GET",n,!1),e.send(null),e.responseText}catch(t){}return""},createXMLHTTPObject:function(){for(var n,e=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],t=0;t<e.length;t++)try{return n=e[t](),this.createXMLHTTPObject=e[t],n}catch(r){}},isSameDomain:function(n){return"undefined"!=typeof location&&-1!==n.indexOf(location.hostname)},getSource:function(n){return n in this.sourceCache||(this.sourceCache[n]=this.ajax(n).split("\n")),this.sourceCache[n]},guessAnonymousFunctions:function(n){for(var e=0;e<n.length;++e){var t=/\{anonymous\}\(.*\)@(.*)/,r=/^(.*?)(?::(\d+))(?::(\d+))?(?: -- .+)?$/,c=n[e],o=t.exec(c);if(o){var s=r.exec(o[1]);if(s){var i=s[1],a=s[2],u=s[3]||0;if(i&&this.isSameDomain(i)&&a){var l=this.guessAnonymousFunction(i,a,u);n[e]=c.replace("{anonymous}",l)}}}}return n},guessAnonymousFunction:function(n,e){var t;try{t=this.findFunctionName(this.getSource(n),e)}catch(r){t="getSource failed with url: "+n+", exception: "+r.toString()}return t},findFunctionName:function(n,e){for(var t,r,c,o=/function\s+([^(]*?)\s*\(([^)]*)\)/,s=/['"]?([$_A-Za-z][$_A-Za-z0-9]*)['"]?\s*[:=]\s*function\b/,i=/['"]?([$_A-Za-z][$_A-Za-z0-9]*)['"]?\s*[:=]\s*(?:eval|new Function)\b/,a="",u=Math.min(e,20),l=0;u>l;++l)if(t=n[e-l-1],c=t.indexOf("//"),c>=0&&(t=t.substr(0,c)),t){if(a=t+a,r=s.exec(a),r&&r[1])return r[1];if(r=o.exec(a),r&&r[1])return r[1];if(r=i.exec(a),r&&r[1])return r[1]}return"(?)"}},n});
